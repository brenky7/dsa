\documentclass[12pt, twoside]{book}
\usepackage[a4paper,top=2.5cm,bottom=2.5cm,left=3.5cm,right=2cm]{geometry}
\usepackage[T1]{fontenc}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{graphicx}
\usepackage{adjustbox}
\usepackage{pdfpages}
\usepackage{listings}
\usepackage{url}
\usepackage{array}
\usepackage{multirow}
\usepackage[utf8]{inputenc}
\usepackage[hidelinks,breaklinks]{hyperref}
\usepackage[slovak]{babel}
\usepackage{indentfirst}
\usepackage{tocloft} 
\usepackage[numbers,sort&compress]{natbib}

\linespread{1.25} % hodnota 1.25 by mala zodpovedat 1.5 riadkovaniu

\lstset{		 % Customizacia zobrazenia kódu
  basicstyle=\ttfamily,      
  keywordstyle=\color{blue},     
  frame=single,        
  breaklines=true,      
}

\usepackage{graphicx}
\graphicspath{ {./images/} }
\newcolumntype{C}[1]{>{\centering\arraybackslash}m{#1}}

% -------------------
% --- Definicia zakladnych pojmov
% -------------------
\def\mfrok{január 2025}
\def\mferok{2025, January}
\def\mfnazov{Zvýšenie efektivity OCSP komunikácie}
\def\mfenazov{Increasing the efficiency of OCSP communication}
\def\mftyp{Priebežná správa o riešení BP1}
\def\mfautor{Peter Brenkus}
\def\mfveduci{Ing. Norbert Varga}
\def\mfeveduci{Ing. Norbert Varga}


\def\mfkonzultant{nikto}  


\def\mfodbor{9.2.1 Informatika}%2508R11  Informatics B-IB}
\def\program{ Informatika }
\def\mfpracovisko{  Ústav počítačového inžinierstva a aplikovanej informatiky }

\newcommand{\subsubsubsection}[1]{%
  \vspace{0.2em}  
  \textbf{#1} \\[0.2em]
  \hspace*{\parindent}
}

\begin{document} 
   
\frontmatter




% -------------------
% --- Titulný list
% -------------------

\thispagestyle{empty}
\noindent

\begin{center}
\sc  
\large

Slovenská technická univerzita v Bratislave\\
Fakulta informatiky a informačných technológií\\
\bigskip
FIIT-XXXXXX-XXXXXX % evidencne cislo par tyzdnov pred odovzdanim dostanem (ais)

\vfill

\mfautor\\
\bigskip
{\mfnazov}\\
\bigskip
\mftyp
\end{center}

\vfill

\noindent
\begin{tabular}{@{}ll}
Študijný program: & \program \\
Študijný odbor: & \mfodbor \\
Miesto vypracovania: & \mfpracovisko \\
Vedúci práce: & \mfveduci \\
\end{tabular}

\bigskip



\noindent
\begin{tabular}{@{}ll}
\mfrok\\
\end{tabular}

\eject % EOP i


% --- Koniec titulnej strany

\newpage\null\thispagestyle{empty}\newpage

\begin{figure}
\includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{./images/zadanie.png}
\end{figure}


\newpage\null\thispagestyle{empty}\newpage

% --- Koniec zadania

\frontmatter

% -------------------
%   čestné vyhlásenie
% -------------------
\newpage
\thispagestyle{empty} 
~

\vfill
\noindent
Čestne vyhlasujem, že som túto prácu vypracoval samostatne, na základe konzultácií a s použitím uvedenej literatúry.

\bigskip
\bigskip
\noindent
V Bratislave, 3.1.2025

{\raggedleft Peter Brenkus\quad \par}
\bigskip

% --- Koniec vyhlásenia
\newpage\null\thispagestyle{empty}\newpage
% -------------------
%  Anotácia - Slovensky
% -------------------

\newpage
\thispagestyle{empty} 
~

\vfill
\noindent

\section*{Poďakovanie}
\bigskip
\noindent
Vedúcemu tejto práce, Norbertovi Vargovi, za vynikajúce vedenie, odborné znalosti a ochotu podeliť sa o cenné rady počas celého procesu tvorby tejto práce. 
\bigskip
\bigskip
\bigskip
\newpage\null\thispagestyle{empty}\newpage

\newpage 
\thispagestyle{empty}

\section*{Anotácia}
\noindent
Slovenská technická univerzita v Bratislave\\
FAKULTA INFORMATIKY A INFORMAČNÝCH TECHNOLÓGIÍ\\

\begin{tabular}{@{}ll}
Študijný program: & \program\bigskip
\bigskip  \\
Autor: & \mfautor \\
Bakalárska práca: &  \mfnazov \\
Vedúci bakalárskej práce: & \mfveduci \\
\mfrok
\end{tabular}

\bigskip
\bigskip 
\bigskip 
\noindent

Cieľom tejto práce je zlepšenie efektivity OCSP protokolu, ktorý sa používa na zistenie neplatného stavu digitálnych certifikátov v reálnom čase. 

Práca obsahuje analýzu problematiky, ktorej súčasťou je podrobný opis jeho architektúry, nedostatkov a ich existujúcich riešení ako OCSP Stapling, OCSP Must-Staple, OCSP Multi-Staple a Tiny OCSP. Na základe tejto analýzy boli sformulované požiadavky a následne návrh riešenia. 

Súčasťou práce je návrh vlastného riešenia, ktoré implementuje HTTP server na cacheovanie POST požiadaviek pre účely OCSP, čím znižuje záťaž OCSP respondérov a zlepšuje efektivitu celého systému.

Čo ešte ďalšie sa robilo...

\newpage\null\thispagestyle{empty}\newpage

% --- Koniec Anotácie - Slovensky


% -------------------
% --- Anotácia - Anglicky 
% -------------------
\newpage
\thispagestyle{empty}
 
\section*{Annotation}
\noindent
Slovak University of Technology in Bratislava\\
FACULTY OF INFORMATICS AND INFORMATION TECHNOLOGIES\\

\begin{tabular}{@{}ll}
Degree course: & Informatics\bigskip
\bigskip  \\
Author: & \mfautor \\
Bachelor’s Thesis: & \mfenazov \\
Supervisor: & \mfeveduci \\
\mferok
\end{tabular}

\bigskip
\bigskip 
\bigskip 
\noindent

The aim of this thesis is to improve the efficiency of the OCSP protocol, which is used for real-time validation of the revocation status of digital certificates.

The thesis includes an analysis of the problem, comprising of a detailed description of the protocol’s architecture, its shortcomings, and existing solutions such as OCSP Stapling, OCSP Must-Staple, OCSP Multi-Stapling, and Tiny OCSP. Based on this analysis, requirements were formulated, followed by the proposal of a solution.

The thesis also presents the design of a custom solution that implements an HTTP server for caching POST requests for OCSP purposes, thereby reducing the load on OCSP responders and improving the overall efficiency of the system.


What else was done... 
 
\newpage\null\thispagestyle{empty}\newpage

% --- Koniec Anotácia - Anglicky


% -------------------
% --- Obsah
% -------------------
\newpage 
\pagestyle{plain}
\setcounter{page}{13}
\fancyfoot[C]{\thepage}
\setlength\cftaftertoctitleskip{20pt}
\tableofcontents

% ---  Koniec Obsahu
\newpage\null\thispagestyle{empty}\newpage



\newpage


\listoffigures

\newpage\null\thispagestyle{empty}\newpage

\newpage

\begin{table}[H]
\begin{center}
\renewcommand\thetable{1}
\caption{Použité skratky}
\begin{tabular}{ |c|C{10cm}| } 
 \hline
\textbf{Skratka} & \textbf{Vysvetlenie} 
 \\ \hline
OCSP  & Online Certificate Status Protocol
\\ \hline
CCSP  & Compressed Certificate Status Protocol
\\ \hline
CRL  & Certificate Revocation List
\\ \hline
CA  & Certificate Authority
\\ \hline
DN  & Distinguished Name
\\ \hline
PKI  & Public Key Infrastructure
\\ \hline
TLS  & Transport Layer Security
\\ \hline
SSL  & Secure Sockets Layer
\\ \hline
ASN.1 & Abstract Syntax Notation One
\\ \hline
DER & Distinguished Encoding Rules
\\ \hline
TLV & Tag Length Value
\\ \hline
MITM & Man in the Middle
\\ \hline
CBOR & Concise Binary Object Representation
\\ \hline
AKID & Authority Key Identifier
\\ \hline
IoT & Internet of things
\\ \hline
HTTP & Hypertext Transfer Protocol
\\ \hline
URL & Uniform Resource Locator
\\ \hline
CDN & Content Delivery Network
\\ \hline
\end{tabular}
\end{center}
\end{table}


\newpage\null\thispagestyle{empty}\newpage

\newpage

\pagestyle{fancy}
\pagenumbering{arabic}
\setcounter{page}{1}

\fancyhf{} 
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[C]{\thepage}
\renewcommand\thesection{\arabic{section}}

\floatstyle{plaintop}
\restylefloat{table}

\section{Úvod}

S rastúcim využívaním digitálnych technológií v každodennom živote sa zvyšujú aj nároky na bezpečnosť online komunikácie. Jedným z prvkov, ktoré zaisťujú túto bezpečnosť sú digitálne certifikáty vydávané a spravované certifikačnými autoritami. Certifikačné autority overujú identitu subjektov a vydávajú im certifikáty, ktoré sú nevyhnutné pre bezpečné šifrované spojenia. Na overovanie platnosti týchto certifikátov v reálnom čase sa používa viacero metód, jednou z nich je protokol OCSP.\cite{certs2}

Vyvinutý ako alternatíva ku CRL, OCSP poskytuje rýchlejší a efektívnejší spôsob overovania certifikátov. Klient, napríklad webový prehliadač, môže poslať dotaz na OCSP server a overiť konkrétny certifikát bez toho, aby musel sťahovať veľký zoznam certifikátov, ako je tomu v prípade CRL.\cite{certs2}

OCSP hrá dôležitú úlohu v bezpečnostných mechanizmoch na internete. Z pohľadu efektivity a rýchlosti komunikácie však stále existuje priestor na jeho zlepšenie. Cieľom tejto práce je analyzovať súčasný stav protokolu OCSP, identifikovať jeho nedostatky a navrhnúť efektívnejšie poskytnutie služby overenia platnosti digitálnych certifikátov.

Kapitola 2 obsahuje analýzu problematiky. Konkrétne úvod do oblasti PKI, digitálnych certifikátov, kontroly ich revokácie a komplexnú analýzu protokolu OCSP. 
Kapitola 3 obsahuje špecifikáciu požiadaviek a prípady použitia. 
Kapitola 4 obsahuje návrh riešenia, s prihliadnutím na ...
Kapitola 5 popisuje implementáciu navrhnutého riešenia.
V kapitole 6 je popísané testovanie implementovaného nástroja a obsahuje aj zhodnotenie toho, ako sa podarilo splniť špecifikované požiadavky. 
Kapitola 7 obsahuje zhodnotenie celej práce.

\newpage
\section{Analýza problematiky}

V tejto časti najprv uvedieme relevantné teoretické oblasti, potom analyzujeme ako presne protokol OCSP funguje a aké sú jeho slabé stránky. Ďalej sa pozrieme aké  vylepšenia už existujú a zameriame sa na oblasti možného ďalšieho vylepšenia.

\subsection{PKI}
PKI je systém, ktorý umožňuje bezpečnú výmenu informácií na internete prostredníctvom kryptografických kľúčov \cite{pki}. Hlavným cieľom PKI je zaručiť bezpečnosť údajov tým, že poskytuje mechanizmy na overenie identity a šifrovanie dát \cite{pki2}. Tento systém vychádza z asymetrickej kryptografie, čiže používa dva druhy kľúčov – verejný a súkromný. Verejný kľúč je zdieľaný verejne a slúži na šifrovanie informácií alebo na overenie podpisu \cite{pki}. Súkromný kľúč je známy len majiteľovi a slúži na dešifrovanie informácií alebo vytváranie digitálnych podpisov \cite{pki2}.


\subsubsection{Digitálne certifikáty}
Digitálny certifikát je kľúčový komponent PKI.\cite{certs} Je to dátová štruktúra, ktorá spája verejný kľúč s identitou osoby alebo organizácie. Certifikáty vydáva dôveryhodná tretia strana nazývaná tiež certifikačná autorita. Existujú rôzne štandardy, ktoré definujú štruktúru digitálnych certifikátov, najpoužívanejší štandard je X.509.\cite{certs} Tento štandard definuje 3 povinné polia pomocou ASN.1.\cite{x509}

\begin{figure}[H]
\begin{lstlisting}
Certificate  ::=  SEQUENCE  {
    tbsCertificate       TBSCertificate,
    signatureAlgorithm   AlgorithmIdentifier,
    signatureValue       BIT STRING
}
\end{lstlisting}
\caption{Štruktúra X.509 certifikátu}
\end{figure}

Každé pole má stanovenú presnú syntax a je zakódované do sekvencie bytov. Na kódovanie sa používa ASN.1 DER, čo je systém založený na kódovaní štýlom TLV. Znamená to, že každý prvok v štruktúre certifikátu je zakódovaný samostatne pomocou troch zložiek:\cite{asn1}
\begin{itemize}
\item Tag identifikuje typ dát (napr. celé číslo, reťazec, sekvencia)
\item Length udáva dĺžku daného prvku v bajtoch
\item Value obsahuje samotné údaje daného prvku.
\end{itemize}

Prvé povinné pole obsahuje údaje o CA, ktorá certifikát vydala a subjekte, ktorému bol certifikát vydaný. Hlavnými údajmi sú názvy CA a subjektu, verejný kľúč subjektu, perióda platnosti certifikátu, číslo verzie cetifikátu a sériové číslo certifikátu. Môžu tu však byť aj ďalšie nepovinné údaje.\cite{x509} 

\begin{figure}[H]
\begin{lstlisting}
TBSCertificate  ::=  SEQUENCE  {
    version         [0]  EXPLICIT Version DEFAULT v1,
    serialNumber         CertificateSerialNumber,
    signature            AlgorithmIdentifier,
    issuer               Name,
    validity             Validity,
    subject              Name,
    subjectPublicKeyInfo SubjectPublicKeyInfo,
    issuerUniqueID  [1]  IMPLICIT UniqueIdentifier OPTIONAL,
    subjectUniqueID [2]  IMPLICIT UniqueIdentifier OPTIONAL,
    extensions      [3]  EXPLICIT Extensions OPTIONAL
}
\end{lstlisting}
\caption{Štruktúra poľa TBSCertificate}
\end{figure}

X.509 certifikáty môžu byť v troch rôznych verziách: v1, v2, a v3. Verzia v1 bola pôvodnou špecifikáciou, avšak nedostatočná pre moderné potreby, najmä kvôli absencii rozšírení. Verzia v2 pridala podporu pre identifikátory vydavateľa a subjektu, čo bolo užitočné pri použití s viacnásobnými certifikačnými autoritami. Verzia v3 je najnovšia a pridáva možnosť rozšírení, ktoré umožňujú špecifikovať ďalšie atribúty, napríklad obmedzenie účelu certifikátu alebo detaily o politíkách certifikácie. Rozšírenia sú kľúčové pre flexibilitu a prispôsobenie certifikátov špecifickým potrebám.\cite{rfc5280}

Každý certifikát má jedinečné sériové číslo priradené CA, ktoré zaručuje jeho jednoznačnú identifikáciu. Toto číslo je dôležité nielen pre správu certifikátov, ale aj pre systémy revokácie.\cite{x509} 

Podpis certifikátu je kľúčovým prvkom, ktorý zaisťuje jeho dôveryhodnosť. Tento podpis generuje certifikačná autorita pomocou svojho privátneho kľúča. Algoritmy použité na tento účel sú asymetrické, čiže, že verejný kľúč CA môže byť použitý na overenie, či bol certifikát skutočne podpísaný CA.\cite{x509}  

\begin{figure}[H]
\begin{lstlisting}
Version  ::=  INTEGER  {  v1(0), v2(1), v3(2)  }
CertificateSerialNumber  ::=  INTEGER
Validity ::= SEQUENCE {
    notBefore      Time,
    notAfter       Time 
}
Time ::= CHOICE {
    utcTime        UTCTime,
    generalTime    GeneralizedTime
}
UniqueIdentifier  ::=  BIT STRING
SubjectPublicKeyInfo  ::=  SEQUENCE  {
    algorithm            AlgorithmIdentifier,
    subjectPublicKey     BIT STRING
}
Extensions  ::=  SEQUENCE SIZE (1..MAX) OF Extension
Extension  ::=  SEQUENCE  {
    extnID      OBJECT IDENTIFIER,
    critical    BOOLEAN DEFAULT FALSE,
    extnValue   OCTET STRING
}
\end{lstlisting}
\caption{Štruktúra atribútov TBSCertificate}
\end{figure}

Atribút issuer obsahuje informácie o certifikačnej autorite, ktorá certifikát vydala. Toto pole je dôležité pri overovaní dôveryhodnosti certifikátu, pretože klienti musia dôverovať certifikačnej autorite, ktorá certifikát vydala.\cite{x509}  

Časové obdobie, počas ktorého je certifikát platný obsahuje dve hodnoty: notBefore a notAfter, ktoré určujú začiatok a koniec platnosti certifikátu. Certifikáty s neplatnými alebo exspirovanými časovými pečiatkami môžu byť  zneužité, preto je dôležité, aby bol certifikát platný iba po nevyhnutnú dobu. Krátka doba platnosti znižuje riziko kompromitácie a uľahčuje správu certifikátov.\cite{x509} 

Entita, ktorá je držiteľom certifikátu, môže byť fyzická osoba, organizácia, alebo webová stránka. Tieto informácie slúžia na identifikáciu subjektu, ktorému bol certifikát vystavený.\cite{x509}  

Verejný kľúč subjektu, ktorý je držiteľom certifikátu je spojený s algoritmom použitým na kryptografické operácie. Táto informácia je nevyhnutná pre asymetrické šifrovanie.\cite{x509} 

\newpage
Druhé povinné pole obsahuje identifikáčné údaje a parametre kryptografického algoritmu, ktorý CA použila na podpis tohto certifikátu. Identifikátor algoritmu sa musí zhodovať s tým, ktorý je zadaný v atribúte signature v poli tbsCertificate.\cite{x509} 

\begin{figure}[H]
\begin{lstlisting}
AlgorithmIdentifier  ::=  SEQUENCE  {
    algorithm    OBJECT IDENTIFIER,
    parameters   ANY DEFINED BY algorithm OPTIONAL  }
}
\end{lstlisting}
\caption{Štruktúra poľa signatureAlgorithm}
\end{figure}

Posledné pole obsahuje digitálny podpis CA, ktorý je vypočítaný zo zakódovanej hodnoty prvého poľa. Týmto podpisom CA potvrdzuje, že verejný kľúč naozaj patrí danému subjektu.\cite{x509} 

Takto vydané certifikáty sa ďalej používajú v TLS a SSL protokoloch na prezentačnej vrstve OSI modelu na zabezpečenie komunikácie medzi klientom a serverom. V rámci TLS/SSL handshake procesu server pošle klientovi svoj certifikát na overenie svojej totožnosti. Certifikát zaslaný serverom si klient môže overiť dvomi najčastejšími spôsobmi, a to pomocou CRL alebo cez OCSP protokol.\cite{certs2}

\subsection{CRL}
Ako už z jeho mena vyplýva, CRL je list revokovaných certifikátov. Tento spôsob overenia platnosti certifikátov je definovaný priamo v X.509 v2 štandarde a vydáva ho buď CA, alebo entita poverená danou CA na tento účel. Každý CRL má určitý rozsah, čiže súbor certifikátov, ktoré môžu byť uvedené na danom CRL. Rozsahom môžu byť  napríklad všetky certifikáty vydané danou CA, alebo aj niečo špecifickejšie, ako napríklad "všetky certifikáty vydané zamestnancom spoločnosti X nachádzajúcim sa v meste Y". CRL má tiež presne definovanú syntax a kóduje sa pomocou ASN.1 DER.\cite{rfc5280}

\begin{figure}[H]
\begin{lstlisting}
CertificateList  ::=  SEQUENCE  {
    tbsCertList          TBSCertList,
    signatureAlgorithm   AlgorithmIdentifier,
    signatureValue       BIT STRING
}
\end{lstlisting}
\caption{Štruktúra CRL}
\end{figure}

\newpage
Prvé pole obsahuje verziu, identifikátor algoritmu použitého na podpis, názov entity, ktorá CRL vydala, čas vydania tejto verzie, čas vydania ďalšej verzie, revokované certifikáty a prípadné nepovinné rozšírenia. Môže sa stať aj, že nie sú žiadne revokované certifikáty, v takom prípade je ich zoznam opomenutý, preto má označenie OPTIONAL.\cite{rfc5280}

\begin{figure}[H]
\begin{lstlisting}
TBSCertList  ::=  SEQUENCE  {
    version                 Version OPTIONAL,
    signature               AlgorithmIdentifier,
    issuer                  Name,
    thisUpdate              Time,
    nextUpdate              Time OPTIONAL,
    revokedCertificates     SEQUENCE OF SEQUENCE  {
        userCertificate         CertificateSerialNumber,
        revocationDate          Time,
        crlEntryExtensions      Extensions OPTIONAL
    }  OPTIONAL,
    crlExtensions           [0]  EXPLICIT Extensions OPTIONAL
}
\end{lstlisting}
\caption{Štruktúra poľa tbsCertList}
\end{figure}

Druhé a tretie pole sú rovnaké ako pri certifikátoch, teda obsahujú identifikátor algortimu použitého na podpis a vypočítanú hodnotu nad zakódovaným prvým poľom.\cite{rfc5280}

\begin{figure}[H]
\includegraphics[width=1\textwidth]{crl.png}
\caption{CRL komunikácia}
\end{figure}

Ak sa klient rozhodne certifikát servera overiť touto metódou, zašle CRL Request na CRL repozitár, ktorý mu v odpovedi pošle CRL. Klient si potom overí, či certifikát, ktorý mu server poslal nie je v tomto zozname. Výhodou tohto systému je jeho jednoduchosť. Zložitosť implementácie takéhoto procesu je minimálna a prevádzkové náklady sú nízke. Vznikajú tu však aj problémy. CA pravidelne aktualizujú tieto listy, no medzi aktualizáciami môže uplynúť určitý čas. Počas tohto obdobia môžu byť niektoré certifikáty revokované, ale ešte neboli pridané do CRL. Zároveň klient pre účely jedného bezpečného spojenia nepotrebuje celý zoznam revokovaných certifikátov, potrebuje overiť plantosť len jedného. S rastúcou veľkosťou CRL prichádzajú problémy s výkonom a efektivitou.\cite{rfc5280, certs2}


\subsection{OCSP}
Ďalším bežne používaným spôsobom overenia platnosti certifikátov je OCSP protokol. Tento protokol bol navrhnutý ako alternatíva k CRL, aby odstránil niektoré obmedzenia spojené s overovaním platnosti certifikátov pomocou CRL, ako je napríklad veľkosť zoznamov a oneskorenie pri ich aktualizácii. OCSP poskytuje dynamickejší a rýchlejší mechanizmus, pretože umožňuje klientovi získať informácie o stave konkrétneho certifikátu v reálnom čase priamo od OCSP respondéra, namiesto sťahovania celého zoznamu odvolaných certifikátov.\cite{certs2}
Je to súhrn pravidiel o tom, ako majú vyzerať dáta, ktoré si musí vymeniť klient s OCSP respondérom na to, aby zistil stav jedného alebo viacerých certifikátov. Skladá sa z dvoch hlavných častí.\cite{certs2, rfc6960}

\begin{itemize}
\item OSCP dopyt
\item OCSP odpoveď
\end{itemize}

\subsubsection{OCSP dopyt}
Táto časť protokolu definuje formát a obsah dát, ktoré klient odosiela OCSP respondéru pri overovaní stavu certifikátu. OCSP dopyt pozostáva z dvoch častí: hlavnej časti (tela dopytu), ktorá obsahuje všetky potrebné informácie o certifikáte, prípadne certifikátoch, ktoré sa majú overiť, a nepovinného digitálneho podpisu. \cite{rfc6960}


\begin{figure}[H]
\begin{lstlisting}
OCSPRequest     ::=     SEQUENCE {
    tbsRequest                  TBSRequest,
    optionalSignature   [0]     EXPLICIT Signature OPTIONAL
}
\end{lstlisting}
\caption{Štruktúra OCSP dopytu}
\end{figure}

Prvé pole dopytu sa týka základných údajov o verzii OCSP protokolu, ktorú klient používa, a ďalších voliteľných informácií, ako napríklad meno žiadateľa, ktoré môže byť potrebné v závislosti od konfigurácie OCSP respondéra. Pole obsahuje aj identifikátory certifikátov, ktoré sa majú overiť, a ďalšie voliteľné rozšírenia, ktoré môžu rozšíriť funkcionalitu dopytu. V prípade, že rozšírenia v dopyte nie sú podporované OCSP respondérom, ten ich môže ignorovať. Je dôležité poznamenať, že jeden OCSP dopyt môže zahŕňať viacero certifikátov, čím sa optimalizuje komunikácia medzi klientom a respondérom. Jednotlivé komponenty tela OCSP dopytu sú definované cez ASN.1.\cite{rfc6960}

\begin{figure}[H]
\begin{lstlisting}
TBSRequest      ::=     SEQUENCE {
    version             [0]  EXPLICIT Version DEFAULT v1,
    requestorName       [1]  EXPLICIT GeneralName OPTIONAL,
    requestList              SEQUENCE OF Request,
    requestExtensions   [2]  EXPLICIT Extensions OPTIONAL
}   
\end{lstlisting}
\caption{Štruktúra poľa TBSRequest}
\end{figure}

Prvý atribút určuje verziu OCSP protokolu, ktorú klient používa. V súčasnosti sa používa verzia 1 (v1), ktorá je prednastavená ako základná verzia protokolu. V budúcnosti môžu byť pridané ďalšie verzie s vylepšeniami.\cite{rfc6960}

\begin{figure}[H]
\begin{lstlisting}
    Version         ::=    INTEGER  { v1(0) }
\end{lstlisting}
\caption{Štruktúra atribútu  version}
\end{figure}

Druhý, voliteľný atribút umožňuje klientovi zahrnúť meno alebo identifikátor, ktorým sa klient identifikuje voči OCSP respondéru. \cite{rfc6960}

Tretí atribút je nevyhnutnou časťou dopytu, ktorá obsahuje zoznam certifikátov, ktoré klient chce overiť. Skladá sa zo sekvencie Requestov, ktoré sa zasa skladajú z CertID objektu a nepovinných rozšírení.\cite{rfc6960}

\begin{figure}[H]
\begin{lstlisting}
    Request         ::=    SEQUENCE {
       reqCert                 CertID,
       singleRequestExtensions [0] EXPLICIT Extensions OPTIONAL
    }
    CertID          ::=     SEQUENCE {
       hashAlgorithm       AlgorithmIdentifier,
       issuerNameHash      OCTET STRING, 
       issuerKeyHash       OCTET STRING, 
       serialNumber        CertificateSerialNumber
    }
\end{lstlisting}
\caption{Štruktúra atribútu requestList}
\end{figure}

Atribút CertID sa skladá z:

\begin{itemize}
\item \textbf{hashAlgorithm}: Tento údaj špecifikuje kryptografický algoritmus, ktorý sa použije na výpočet hashu potrebného na identifikáciu certifikátu. 

\item \textbf{issuerNameHash}: Hash mena vydavateľa certifikátu. Tento hash je vypočítaný na základe plného DN vydavateľa, ktoré je použité na jednoznačnú identifikáciu CA.

\item \textbf{issuerKeyHash}: Hash verejného kľúča vydavateľa, čo je ďalší údaj, ktorý pomáha jednoznačne identifikovať vydavateľa certifikátu.

\item \textbf{serialNumber}: Sériové číslo certifikátu, ktoré jednoznačne identifikuje konkrétny certifikát vydaný danou certifikačnou autoritou.
\end{itemize}

Posledný atribút poľa TBSRequest je voliteľný a umožňuje zahrnúť rozšírenia špecifické pre OCSP dopyt. Tieto rozšírenia môžu poskytovať dodatočné informácie alebo požiadavky, ktoré respondér môže, ale nemusí spracovať.\cite{rfc6960}

Keď respondér obdrží dopyt, vyhodnotí, či dopyt má správnu štruktúru, ďalej vyhodnotí, či je nakonfigurovaný tak, aby mohol poskytnúť požadovanú službu a nakoniec vyhodnotí, či dopyt obsahuje potrebné povinné údaje. Potom dopyt spracuje a odošle klientovi odpoveď.\cite{rfc6960}

\subsubsection{OCSP odpoveď}
OCSP odpovede sa skladajú z typu odpovede a samotného obsahu odpovede.\cite{rfc6960} Môžu mať rôzne typy, ale je definovaný jeden základný, ktorý musí podporovať každý OCSP respondér aj klient a všetky definitívne odpovede musia byť podpísané. Na podpis odpovede môžu byť použité verejné kľúče jednej z troch entít:
\begin{itemize}
\item CA, ktorá daný certifikát vydala
\item Dôveryhodný respondér, ktorému klient verí
\item Autorizovaný respondér, ktorého poverila daná CA
\end{itemize}

\begin{figure}[H]
\begin{lstlisting}
OCSPResponse ::= SEQUENCE {
    responseStatus         OCSPResponseStatus,
    responseBytes          [0] EXPLICIT ResponseBytes OPTIONAL
}
\end{lstlisting}
\caption{Štruktúra OCSP odpovede}
\end{figure}

Atribút responseStatus určuje stav odpovede a môže mať jednu z preddefinovaných hodnôt. Tieto hodnoty informujú, či bola odpoveď úspešne vytvorená alebo či došlo k chybe.\cite{rfc6960}

\begin{figure}[H]
\begin{lstlisting}
OCSPResponseStatus ::= ENUMERATED {
    successful         (0),  
    malformedRequest   (1), 
    internalError      (2),  
    tryLater           (3), 
                    -- (4) is not used
    sigRequired        (5),  
    unauthorized       (6)  
   }
\end{lstlisting}
\caption{Štruktúra atribútu responseStatus}
\end{figure}

Druhý atribút responseBytes obsahuje konkrétne údaje týkajúce sa odpovede, ak bola úspešne vytvorená (ak bol stav responseStatus 0). Toto pole je voliteľné, čo znamená, že sa použije len v prípade úspešnej odpovede. Ak odpoveď nie je úspešná, toto pole môže byť prázdne.\cite{rfc6960}

\begin{figure}[H]
\begin{lstlisting}
ResponseBytes ::=       SEQUENCE {
    responseType   OBJECT IDENTIFIER,
    response       OCTET STRING
}
\end{lstlisting}
\caption{Štruktúra atribútu responseBytes}
\end{figure}

Prvý atribút v responseType je identifikátor objektu, ktorý označuje typ odpovede. Pre základnú OCSP odpoveď, ktorú musí každý OCSP respondér podporovať, je hodnota tohoto atribútu id-pkix-ocsp-basic. Tento identifikátor určuje, že odpoveď je štandardného typu.\cite{rfc6960}

\begin{figure}[H]
\begin{lstlisting}
BasicOCSPResponse       ::= SEQUENCE {
    tbsResponseData      ResponseData,
    signatureAlgorithm   AlgorithmIdentifier,
    signature            BIT STRING,
    certs            [0] EXPLICIT SEQUENCE OF Certificate OPTIONAL
}
\end{lstlisting}
\caption{Štruktúra atribútu response}
\end{figure}

Atribút response v poli responseBytes obsahuje údaje odpovede. Pri základnej odpovedi BasicOCSPResponse sú definované štyri hlavné atribúty: údaje odpovede, použitý algoritmus na podpisovanie, samotný podpis a prípadne zoznam certifikátov použitých na overenie podpisu.\cite{rfc6960}

\begin{figure}[H]
\begin{lstlisting}
ResponseData ::= SEQUENCE {
    version              [0] EXPLICIT Version DEFAULT v1,
    responderID              ResponderID,
    producedAt               GeneralizedTime,
    responses                SEQUENCE OF SingleResponse,
    responseExtensions   [1] EXPLICIT Extensions OPTIONAL
}
\end{lstlisting}
\caption{Štruktúra atribútov ResponseData a ResponderID}
\end{figure}

Atribút tbsResponseData v BasicOCSPResponse obsahuje údaje o odpovedi, ktoré sa podpisujú. Tieto údaje obsahujú verziu  OCSP odpovede, identifikátor respondéra, ktorý vytvoril odpoveď,  čas, kedy bola odpoveď vytvorená, zoznam jednotlivých odpovedí týkajúcich sa certifikátov, ktoré boli predmetom dopytu a prípadné rozšírenia. Aj tieto majú presne definovanú štruktúru.\cite{rfc6960}


Atribút ResponderID identifikuje OCSP respondéra, ktorý vytvára odpoveď. Sú dva spôsoby, ako môže byť respondér identifikovaný, a to buď pomocou mena alebo hashu jeho verejného kľúča.\cite{rfc6960}

Atribút SingleResponse je odpoveď na jeden certifikát. Obsahuje identifikátor certifikátu, ktorého stav sa overuje, aktuálny stav certifikátu, časovú pečiatku, ktorá indikuje, kedy bol stav certifikátu naposledy overený, prípadnú časovú pečiatku ďalšej očakávanej aktualizácie stavu certifikátu a voliteľné rozšírenia.\cite{rfc6960}

\begin{figure}[H]
\begin{lstlisting}
ResponderID ::= CHOICE {
    byName               [1] Name,
    byKey                [2] KeyHash
}
KeyHash ::= OCTET STRING 
SingleResponse ::= SEQUENCE {
    certID                       CertID,
    certStatus                   CertStatus,
    thisUpdate                   GeneralizedTime,
    nextUpdate         [0]       EXPLICIT GeneralizedTime OPTIONAL,
    singleExtensions   [1]       EXPLICIT Extensions OPTIONAL
}
CertStatus ::= CHOICE {
    good        [0]     IMPLICIT NULL,
    revoked     [1]     IMPLICIT RevokedInfo,
    unknown     [2]     IMPLICIT UnknownInfo
}
RevokedInfo ::= SEQUENCE {
    revocationTime              GeneralizedTime,
    revocationReason    [0]     EXPLICIT CRLReason OPTIONAL
}
\end{lstlisting}
\caption{Štruktúra atribútov ResponseData a ResponderID}
\end{figure}

Stav certifikátu môže byť v poriadku, odvolaný alebo neznámy. Ak je certifikát odvolaný, atribút RevokedInfo obsahuje informácie o čase a dôvode revokácie. Takáto odpoveď indikuje, že daný certifikát má byť odmietnutý. Neznáma odpoveď znamená, že respondér nevie o danom certifikáte, čiže buď nepozná CA, ktorá vydala daný certifikát, alebo jednoducho danú CA neobsluhuje. Stav v poriadku znamená, že certifikát s daným identifikátorom a periódou platnosti nebol revokovaný. Nepotvrdzuje to však, že certifikát bol vôbec niekedy vydaný, alebo že čas, kedy bola odpoveď vygenerovaná je v rámci intervalu platnosti certifikátu. Na posúdenie týchto vlastností môžu však byť použité nepovinné rozšírenia.\cite{rfc6960}

\subsection{Nedostatky OCSP protokolu}
Protokol OCSP bol navrhnutý ako rýchlejšia a efektívnejšia alternatíva ku CRL. Napriek svojim výhodám však obsahuje určité slabiny a neefektívne miesta, ktoré môžu negatívne ovplyvniť jeho použitie v praxi. Táto podkapitola sa zameriava na hlavné výzvy OCSP protokolu, vrátane výkonnostných a bezpečnostných problémov a problémov s podporou.

\subsubsection{Problémy s výkonom}
Výkonnosť je jedným z kľúčových aspektov, ktoré môžu ovplyvniť použiteľnosť a spoľahlivosť OCSP protokolu. Hoci je OCSP navrhnutý tak, aby bol rýchlejší a efektívnejší ako CRL, jeho implementácia a architektúra môžu viesť k viacerým výkonnostným problémom, najmä v prostrediach s vysokou záťažou.

\subsubsubsection{Latencia spôsobená dodatočnými sieťovými požiadavkami}
Jedným z hlavných výkonnostných problémov OCSP protokolu je potreba vytvorenia nového sieťového spojenia pre každú požiadavku klienta. Pri každom pokuse o overenie certifikátu klient posiela požiadavku na OCSP respondér a čaká na odpoveď. Táto dodatočná komunikácia predlžuje čas potrebný na dokončenie procesov, ako je TLS handshake a načítanie webovej stránky. Latencia sa taktiež môže zvýšiť, ak je OCSP respondér geograficky vzdialený od klienta alebo ak je spojenie medzi nimi pomalé. Atutxa et al. vo svojej práci z roku 2023 ukázali, že v IIoT prostredí, kde sa využíva DTLS protokol na zabezpečenie spojenia, overenie certifikátu cez OCSP zaberá viac ako 50\% celkového času handshake.\cite{atutxa}

\subsubsubsection{Škálovateľnosť OCSP respondérov}
OCSP respondéry musia byť schopné zvládnuť veľké množstvo požiadaviek v reálnom čase, čo môže predstavovať značný výkonnostný problém. V prostrediach s vysokou záťažou, ako sú veľké webové platformy alebo systémy s miliónmi používateľov, sa OCSP respondéry stávajú úzkym miestom. Ak nie sú dostatočne dimenzované alebo optimalizované, môžu sa stať neodpovedajúcimi alebo reagovať pomaly, čo ovplyvňuje nielen klientov, ale aj celkovú dôveryhodnosť systému.\cite{wazan, smith}

\subsubsection{Problémy s bezpečnosťou}
OCSP protokol bol navrhnutý s cieľom poskytnúť dynamické a spoľahlivé overovanie platnosti certifikátov. Napriek tomu obsahuje niekoľko bezpečnostných slabín, ktoré môžu ohroziť dôveryhodnosť a integritu procesu overovania. Tieto problémy vyplývajú najmä z charakteru jeho implementácie, závislosti na sieťovej komunikácii a niektorých dizajnových rozhodnutí.

\subsubsubsection{Závislosť na dostupnosti OCSP respondérov}
Jednou z hlavných bezpečnostných slabín OCSP protokolu je jeho závislosť na dostupnosti OCSP respondérov. Ak respondér nie je dostupný, klient nie je schopný overiť stav certifikátu. To vedie k situáciám, kedy mnoho klientov a webových prehliadačov používa tzv. "soft fail"\ mechanizmus. Tento prístup znamená, že ak OCSP odpoveď nie je dostupná, klient predpokladá, že certifikát je platný. Soft fail je problematický, pretože umožňuje útočníkovi narušiť spojenie medzi klientom a OCSP respondérom a zabrániť tak overeniu stavu certifikátu. Týmto spôsobom môže byť certifikát, ktorý bol odvolaný, stále akceptovaný klientom, čo vážne ohrozuje bezpečnosť komunikácie.\cite{security_pki}

\subsubsubsection{Odhalenie súkromných informácií klienta}
OCSP protokol môže neúmyselne ohroziť súkromie používateľov. Pri každom dopyte na OCSP respondér klient odosiela informácie o konkrétnom certifikáte, ktorý chce overiť. Tieto dopyty môžu byť sledované, čo umožňuje OCSP respondéru alebo potenciálnym útočníkom získať informácie o tom, aké webové stránky alebo služby klient používa. Táto vlastnosť môže byť využitá na sledovanie online aktivity používateľov a predstavuje významný problém v kontexte ochrany súkromia. Napríklad, ak sa OCSP respondér nachádza v jurisdikcii, ktorá umožňuje monitorovanie siete, údaje o dopytoch môžu byť ľahko zneužité.\cite{turin2}

\subsubsubsection{Náchylnosť na MITM útoky}
OCSP protokol je náchylný na útoky typu MITM, ak nie sú implementované dostatočné mechanizmy na ochranu integrity komunikácie medzi klientom a OCSP respondérom. Útočník môže zachytiť a upraviť dopyty alebo odpovede OCSP, čím môže klientovi poskytnúť nesprávne informácie o stave certifikátu. Napríklad útočník môže zachytiť skutočnú odpoveď a poslať falošnú, že odvolaný certifikát je platný, čím umožní použitie neplatného certifikátu na vytvorenie spojenia.\cite{eddie}

\subsubsection{Nedostatočná podpora}
Ďalšou prekážkou pri OCSP komunikácii je neúplná alebo nedostatočná podpora zo strany rôznych komponentov infraštruktúry. Tieto problémy môžu brániť jeho širšej adopcii a ovplyvňovať jeho účinnosť a spoľahlivosť v reálnych aplikáciách.


\subsubsubsection{Slabá podpora na strane klientov}
Podpora OCSP protokolu na strane klientov, ako sú webové prehliadače a aplikácie, nie je vždy konzistentná. Niektoré prehliadače, napríklad Google Chrome alebo Mozilla  Firefox v predvolenom nastavení nepoužívajú OCSP protokol na overovanie certifikátov. Namiesto toho sa spoliehajú na alternatívne mechanizmy, ako je CRLset alebo OneCRL.\cite{turin} Táto slabá podpora môže viesť k situáciám, kedy OCSP protokol nie je vôbec využívaný, aj keď by mohol zlepšiť bezpečnosť a efektivitu komunikácie.


\subsubsection{Zhrnutie}
Aj keď OCSP má potenciál priniesť výhody v oblasti efektivity a rýchlosti, v praxi sa stretáva s viacerými obmedzeniami, ktoré ovplyvňujú jeho výkon, bezpečnosť a podporu. Výkonnostné problémy súvisia najmä s latenciou a vysokými nárokmi na škálovateľnosť OCSP respondérov. Tieto faktory môžu viesť k spomaleniu komunikácie a zvýšeniu prevádzkových nákladov.

Z bezpečnostného hľadiska je OCSP zraniteľný voči viacerým hrozbám, ako sú útoky typu MITM, odhalenie súkromných informácií používateľov či dôsledky "soft fail" mechanizmu pri výpadku OCSP respondérov. Tieto slabiny môžu výrazne ohroziť dôveryhodnosť protokolu a integritu procesu overovania certifikátov. Nedostatočná podpora na strane klientov, najmä v niektorých webových prehliadačoch, ešte viac obmedzuje efektívne využitie tohto protokolu v praxi.


\subsection{Existujúce riešenia}
Pre zlepšenie efektivity a širšie prijatie OCSP je potrebné riešenie týchto nedostatkov. Odborná komunita už prišla s rôznymi významnými vylepšeniami, ktoré zlepšujú OCSP v týchto oblastiach. V tejto kapitole prejdeme hlavné existujúce vylepšenia pre OCSP.


\subsubsection{OCSP Stapling}
OCSP stapling je jedným z najvýznamnejších vylepšení OCSP protokolu, ktoré rieši viaceré jeho výkonové a bezpečnostné nedostatky. Táto metóda umožňuje serveru zahrnúť OCSP odpoveď priamo do TLS handshake, čím eliminuje potrebu klienta samostatne kontaktovať OCSP respondér. Zavedenie OCSP Staplingu prináša niekoľko výhod, ktoré zvyšujú efektivitu, spoľahlivosť a bezpečnosť procesu overovania platnosti certifikátov.

\subsubsubsection{Princíp fungovania OCSP staplingu}
V tradičnom OCSP modeli klient posiela dopyt na OCSP respondér, aby získal informácie o stave konkrétneho certifikátu. Pri OCSP staplingu však server sám periodicky kontaktuje OCSP respondér, získava aktuálnu odpoveď a túto odpoveď následne "pripne"\ (angl. "staple") k svojmu certifikátu počas TLS handshake komunikácie s klientom. Klient tak dostane OCSP odpoveď priamo od servera a nemusí samostatne komunikovať s OCSP respondérom. 

Klient si stav certifikátu stále môže overiť aj sám cez OCSP respondéra. To je užitočné pre prípady, keď server z akéhokoľvek dôvodu zlyhá v pripojení OCSP odpovede do TLS handshake. V takýchto prípadoch sa systém vracia k obyčajnému OCSP modelu.

\begin{figure}[H]
\centering
\includegraphics[height=0.3\textheight]{images/stapling.png}
\caption{Schéma OCSP stapling komunikácie.}
\end{figure}

\subsubsubsection{Výhody a  nevýhody OCSP staplingu}
OCSP Stapling prináša niekoľko kľúčových výhod:

\begin{enumerate}
\item \textbf{Zníženie latencie} \\
Eliminuje dodatočné sieťové spojenie medzi klientom a OCSP respondérom, čím skracuje čas potrebný na dokončenie TLS handshake. To zlepšuje užívateľskú skúsenosť, najmä pri webových aplikáciách citlivých na výkon.

\item \textbf{Zníženie záťaže OCSP respondérov} \\
Vďaka tomu, že server sám pravidelne kontroluje svoj certifikát, jeho klienti to už nemusia robiť každý zvlášť. OCSP stapling teda znižuje počet dopytov smerujúcich na OCSP respondérov a ich celkovú sieťovú a výpočtovú záťaž. Toto riešenie je výhodné najmä pre veľké systémy s vysokým počtom klientov, kde môže základný OCSP model predstavovať úzke miesto.

\item \textbf{Zlepšenie ochrany súkromia} \\
Keďže klient nekomunikuje priamo s OCSP respondérom, eliminuje sa možnosť sledovania aktivity používateľa na základe OCSP dopytov. Vďaka tomu OCSP stapling výrazne  napomáha k súkromiu koncového užívateľa.

\end{enumerate}

Okrem významných, vyššie spomenutých výhod prináša OCSP stapling so sebou aj nové 
obmedzenia a výzvy.

\begin{enumerate}
\item \textbf{Presun OCSP komunikácie z klienta na server} \\
V praxi sa môžu architektúry serverov rôznych webových stránok líšiť v mnohých aspektoch, keďže každý je uspôsobný na mieru pre svoj používateľský scenár. 
Vzhľadom na to, že OCSP stapling pridáva logiku navyše pre tieto servery, aj ich 
schopnosť na adaptáciu tejto novej logiky môže byť odlišná.

\item \textbf{Riziko neaktuálnych OCSP odpovedí} \\
Tie servery, ktoré stapling podporujú, zároveň na seba preberajú aj riziko neaktuálnych OCSP odpovedí, ktoré pred tým niesli  OCSP respondéry.
Vzhľadom na to, že OCSP odpovede priložené serverom majú obmedzenú dobu platnosti, ak server nezíska novú OCSP odpoveď pred vypršaním tej aktuálnej, môže poskytnúť klientovi zastaranú odpoveď. To môže viesť k problémom s dôveryhodnosťou alebo zneužitím.

\item \textbf{Obmedzená podpora na strane klientov} \\
Podobne ako webové servery, aj ich klienti môžu mať problém so spracovaním OCSP odpovede priloženej k TLS handshake. Tento nedostatok môže obmedziť praktické výhody OCSP staplingu, najmä pri širokej škále zariadení a softvérov.

\end{enumerate}

Aj napriek významným vylepšeniam, ktoré OCSP Stapling prináša oproti základnému OCSP modelu je táto metóda stále málo používaná. Zulfiqar et al. vo svojom výskume z roku 2021, zameranom na prijatie bezpečnostných mechanizmov u X.509 certifikátov ukázali, že v roku 2020 iba 29.67~\% z 50 000 najpoužívanejších webových stránok podporovalo OCSP stapling \cite{stapling_adoption}. Takáto nízka miera adopcie naznačuje, že ekosystém certifikátov a súvisiace infraštruktúry ešte nie sú dostatočne pripravené na plnú implementáciu OCSP Staplingu. Na podporu širšieho prijatia tejto technológie budú potrebné ďalšie vylepšenia, ako napríklad lepšia podpora na strane serverov a klientov a efektívnejšia implementácia protokolu.


\subsubsection{OCSP Must-Staple}
Ďalším vylepšením OCSP protokolu je OCSP Must-Staple, ktoré zvyšuje jeho bezpečnosť a spoľahlivosť tým, že priamo vyžaduje priloženie OCSP odpovede k  certifikátu počas TLS handshake. Táto funkcionalita je implementovaná ako rozšírenie v certifikáte a zaväzuje server k poskytovaniu aktuálnej OCSP odpovede. V prípade, že server OCSP odpoveď nepriloží, klient automaticky odmietne nadviazať spojenie.


\subsubsubsection{Princíp fungovania OCSP Must-Staple}
\begin{figure}[H]
\centering
\includegraphics[height=0.3\textheight]{images/must_staple.png}
\caption{Schéma OCSP Must-Staple komunikácie.}
\end{figure}

OCSP Must-Staple je realizovaný pomocou špeciálneho rozšírenia X.509 certifikátu s názvom TLS Feature Extension. Toto rozšírenie obsahuje špecifikáciu, že server musí poskytovať OCSP odpoveď ako súčasť TLS handshake. Klient, ktorý prijme certifikát s týmto rozšírením, overí prítomnosť OCSP odpovede. Ak odpoveď chýba, spojenie je zamietnuté ako neplatné. Mechanizmus teda funguje ako striktné vynucovanie OCSP Staplingu, čím eliminuje riziko nastatia "soft fail"\ scenárov.

\subsubsubsection{Výhody a nevýhody OCSP Must-Staple}
Vzhľadom na to, že tento model vychádza z OCSP staplingu, prináša so sebou všetky jeho výhody. Okrem nich však Must-Staple poskytuje aj jedno významné bezpečnostné vylepšenie. Základný OCSP model aj OCSP Stapling umožňujú "soft fail", pri ktorom prehliadač povolí spojenie, aj keď nie je možné overiť stav certifikátu, napríklad pri výpadku OCSP respondéra. OCSP Must-Staple tento problém rieši tým, že prítomnosť OCSP odpovede je povinná. Ak server nepriloží aktuálnu OCSP odpoveď, spojenie je automaticky odmietnuté, čím sa eliminuje riziko takýchto scenárov.

Tak ako pri OCSP Staplingu, aj Must-Staple si vyžaduje dôslednú implementáciu na strane serverov aj klientov, no jeho podpora je stále obmedzená. Staršie webové servery a prehliadače často nepoznajú OCSP Must-Staple alebo ho nepodporujú, čo obmedzuje jeho praktické využitie. Friess et. al. vo svojom výskume z roku 2023 zistili, že až 89.5~\% z 530 000 klientov jednoducho odignorovalo Must-Staple rozšírenie certifikátov pri načítavaní webovej stránky.\cite{security_pki}

Aj napriek početným vylepšeniam oproti základnému OCSP modelu je aktuálna adopcia tejto metódy minimálna. Hlavnými prekážkami jej širšieho rozšírenia sú technické obmedzenia na strane serverov a klientov, ako aj náročnosť na správu aktuálnych OCSP odpovedí. Pre dosiahnutie plného potenciálu OCSP Must-Staple je preto nevyhnutná lepšia podpora v infraštruktúre a zvýšená adopcia zo strany vývojárov webových aplikácií a certifikačných autorít.


\subsubsection{OCSP Multi-Stapling}
Podobne ako Must-Staple, aj OCSP Multi-Stapling je rozšírenie OCSP Staplingu. Toto rozšírenie umožňuje serveru priložiť viacero OCSP odpovedí v rámci jedného TLS handshake. To je užitočné najmä v situáciách, keď je potrebné overiť celý certifikátový reťazec, nielen koncový certifikát.

V praxi sú certifikáty totiž často podpísané certifikátovými reťazcami a nie priamo CA. Certifikáty v tomto reťazci sú hierarchicky usporiadané a každý certifikát je podpísaný nadriadeným certifikátom až po koreňový certifikát, ktorý je dôveryhodný a patrí CA. Ak klient overuje platnosť koncového certifikátu, často potrebuje overiť aj ostatné certifikáty v takomto reťazci. V základnom OCSP Stapling modeli toto nie je domyslené, a napriek tomu, že server pošle OCSP odpoveď pre svoj certifikát, klient si v takýchto prípadoch musí sám overiť platnosť ostatných certifikátov v reťazci.

OCSP Multi-Stapling tento problém rieši tým, že server pripraví a priloží OCSP odpovede pre viacero certifikátov v reťazci v rámci jednej komunikácie s klientom.


\subsubsubsection{Princíp fungovania OCSP Multi-Staplingu}
\begin{enumerate}
\item \textbf{Získanie OCSP odpovedí} \\
Server periodicky získava OCSP odpovede pre všetky certifikáty v certifikátovom reťazci od príslušných OCSP respondérov.

\item\textbf{ Priloženie OCSP odpovedí}\\
Počas TLS handshake server priloží OCSP odpovede nielen pre svoj koncový certifikát, ale aj pre všetky ostatné certifikáty v reťazci.

\item \textbf{Overenie klientom}\\
Klient prijme OCSP odpovede v rámci TLS komunikácie a vie si overiť platnosť koncového certifikátu spolu s celým reťazcom.
\end{enumerate}

Týmto spôsobom klient získa všetky potrebné informácie na overenie platnosti certifikátov naraz, bez potreby dodatočnej komunikácie s OCSP respondérmi.

\subsubsubsection{Výhody a nevýhody OCSP Multi-Stapling}
Aj táto metóda so sebou prináša všetky výhody OCSP Staplingu. Okrem toho však má klient okamžite prístup k OCSP odpovediam pre všetky certifikáty v reťazci, čo skracuje čas potrebný na ich overenie. Tento prístup je efektívny najmä v systémoch, kde je certifikátový reťazec zložený z viacerých  certifikátov.

Nevýhodami tohto prístupu sú zväčšenie veľkosti TLS handshake a náročnejšia implementácia na strane servera, keďže server musí periodicky získavať a aktualizovať OCSP odpovede pre všetky certifikáty v reťazci. Okrem toho tu tiež platí závislosť na podpore zo strany serverov a klientov a prenesenie rizika neaktuálnych OCSP odpovedí na server.

\subsubsection{Compressed Certificate Status Protocol}
Ďalším existujúcim vylepšením je CCSP, ktoré sa zameriava na zníženie dátovej náročnosti a zrýchlenie procesu overovania platnosti certifikátov. Cieľom CCSP je komprimovať OCSP odpovede, aby sa zmenšila veľkosť prenášaných dát a zároveň sa zachovala bezpečnosť a integrita procesu.

CCSP prináša novú abstrakciu, tzv. "podpísané kolekcie"\, v ktorých sú informácie o stave viacerých certifikátov uchované v jednej odpovedi, čím sa znižuje réžia. Okrem toho sú tieto kolekcie následne komprimované podľa priestoru a času.\cite{ccsp}

\subsubsubsection{Princíp fungovania CCSP}

\begin{enumerate} 
\item \textbf{Podpísané kolekcie} \\
Podpísané kolekcie sú reprezentované bitovou mapou, v ktorej každý bit reprezentuje jeden certifikát a jeho hodnota predstavuje informáciu o jeho platnosti. Kolekcia sa následne podpíše a vydá.\cite{ccsp}


\item \textbf{Optimalizácia podľa priestoru} \\
Keďže väčšina certifikátov ktorejkoľvek CA nie je revokovaná,\cite{ccsp} veľká časť takejto bitmapy má rovnaké hodnoty. To vytvára priestor pre kompresiu samotnej bitmapy. Na tento účel autori implementovali podporu pre algoritmy DEFLATE a Golomb.\cite{ccsp}

\item \textbf{Optimalizácia podľa času} \\
Každá kolekcia sa podpisuje a vydáva periodicky, interval medzi jednotlivými vydaniami je v rozmedzí sekúnd až minút. Keďže rozdiely mezdi jednotlivými verziami sú v tak malom čase minimálne, ak vôbec nejaké, autori zaviedli systém pre optimalizáciu podľa času. Namiesto vydávania novej podpísanej kolekcie v každej iterácii cyklu,  sa väčšinu času vydávajú iba jej zmeny oproti poslednej verzii. Celá nová podpísaná kolekcia sa vydáva v intervaloch niekoľkých hodín.\cite{ccsp}

\item \textbf{Podpora pre Stapling} \\
Pre ešte väčšie zlepšenie autori zahrnuli do návrhu mechanizmus pre pripnutie podpísaných kolekcií alebo ich posledných zmien rovno ku certifikátu počas TLS handshake, čím využívajú aj výhody, ktoré prináša OCSP Stapling.\cite{ccsp}
\end{enumerate}

\subsubsubsection{Výhody a nevýhody CCSP}
Hlavnou výhodou tohoto riešenia je použitie komprimovaných podpísaných kolekcií, ktoré významne redukujú objem prenášaných dát. Autori vo svojom článku ukázali, že     ich riešenie spotrebuje vyše stonásobne menej úložiska v porovnaní s tradičnými CRL a znižuje počet podpisov o viac než milión-násobok oproti klasickému OCSP Staplingu. \cite{ccsp}

Ďalšou výhodou tohto riešenia je vopred zabudovaný mechanizmus pre pripnutie podpísaných sád a ich zmien do TLS handshake, čím využíva aj výhody OCSP Staplingu, najmä ochrana súkromia používateľa.\cite{ccsp}

Nevýhodou tohto prístupu je opäť to, že vyžaduje úpravy na strane OCSP respondérov a serverov na generovanie a správu komprimovaných odpovedí ako aj na strane klientov na spracovávanie podpísaných kolekcií v odpovediach. Momentálne nie sú verejné žiadne štatistiky o miere adopcie tohto vylepšenia.

\subsubsection{Tiny OCSP}
Tiny OCSP je vylepšenie zamerané na minimalizáciu veľkosti OCSP dopytov a odpovedí, čo je kritické pre zariadenia v IoT prostredí s obmedzenými výpočtovými zdrojmi a sieťovými kapacitami. Cieľom Tiny OCSP je zachovať funkcionalitu klasického OCSP pri výraznom znížení dátovej záťaže a spotreby energie, ktoré sú kritickými faktormi v aplikáciách pre nízkonákladové a batériovo napájané zariadenia.

\subsubsubsection{Hlavné optimalizácie}
Tiny OCSP prináša niekoľko kľúčových zmien, ktoré umožňujú minimalizovať dátové požiadavky:

\begin{itemize}
\item \textbf{CBOR namiesto ASN.1}\\
Tiny OCSP používa na kódovanie dopytov a odpovedí CBOR, ktoré je oveľa kompaktnejšie a efektívnejšie pre IoT zariadenia ako ASN.1 DER kódovanie.

\item \textbf{Využitie AKID rozšírenia pre X.509 certifikáty}\\
Vo východiskovej definícii OCSP je identifikácia relevantnej CA v dopytoch vyriešená pomocou identifikátoru hash funkcie a hashu identifikátoru CA. Autori TinyOCSP ukázali, že v najlepšom prípade táto informácia zaberá až 53 bajtov, pričom pri zložiteších hash funkciach to môže byť ešte viac. Riešením v TinyOCSP je využitie rozšírenia Authority Key Identifier z X.509 certifikátov, ktoré slúži na rovnaký účel a má podľa RFC 5280 §4.2.1.1 odporúčanú dĺžku iba 8 bajtov.

\item \textbf{Odstránenie redundantných dát z odpovedí}\\
Tiny OCSP v odpovedi neposiela znovu certifikát, ktorý sa overuje. Namiesto toho podpisuje a posiela konkatenáciu dopytu a odpovede, čím autentizuje odpoveď bez opakovania týchto dát. V rámci optimalizácie sú z odpovedí ešte odstránené polia  obsahujúce informácie, ktoré sú strane posielajúcej dopyt už známe a redundantné časové údaje. Príkladom sú polia ako \texttt{responderID} a niektoré časové značky, napríklad \texttt{producedAt}. Týmto prístupom sa minimalizuje veľkosť OCSP odpovede bez straty funkčnosti, pretože redundantné informácie nie sú pre príjemcu prínosné a iba zbytočne zvyšujú dátový objem.

\end{itemize}

\subsubsubsection{Štruktúra Tiny OCSP správ}
Dopyt obsahuje tri hlavné atribúty, a to sú verzia, sekvencia certifikátov na overenie a nepovinná jednorázová náhodná hodnota. 

\begin{figure}[H]
\centering
\includegraphics[height=0.25\textheight]{images/tiny_request.png}
\caption{Štruktúra Tiny OCSP dopytu zakódovaná pomocou CBOR.}
\end{figure}

Atribút verzia má veľkosť jedného bajtu a slúži klientovi na to, keď chce od respondéra vyžiadať, aby ku odpovedi priložil svoj vlastný certifikát. Hoci autori nešpecifikovali aké konkrétne hodnoty môže nadobúdať, upresnili, že východiskový stav je ten, kedy sa certifikát respondéra nevyžaduje.

Certifikáty, ktoré klient chce overiť sú definované ako pár AKID a sériového čísla 
čísla certifikátu a dokopy majú dvanásť bajtov pre jeden certifikát.

Jednorázová náhodná hodnota \texttt{nonce} je jedinou nepovinnou súčasťou dopytu.  Slúži ako ochrana pred útokmi opätovného prehratia, pri ktorých by útočník mohol zachytiť platnú OCSP odpoveď a neskôr ju neoprávnene znovu použiť. Vďaka jedinečnej hodnote \texttt{nonce} môže klient overiť, že odpoveď od OCSP respondéra zodpovedá konkrétnemu dopytu a nie je zneužitá.

\begin{figure}[H]
\centering
\includegraphics[height=0.25\textheight]{images/tiny_response.png}
\caption{Štruktúra Tiny OCSP odpovede zakódovaná pomocou CBOR.}
\end{figure}

Odpoveď v Tiny OCSP obsahuje tri hlavné atribúty, medzi ktoré patria podpis, sekvencia odpovedí na certifikáty z dopytu, a nepovinný zoznam certifikátov samotného respondéra.

Podpis slúži na autentizáciu správy takisto ako pri bežnom OCSP. Počíta sa nad konkatenáciou celého dopytu a sekvenciou stavov certifikátov v odpovedi a pre jeden certifikát má veľkosť 67 bajtov.

Atribút \texttt{authenticated} obsahuje časovú pečiatku a pole stavov, ktoré mapuje stavy jednotlivých certifikátov v takom poradí v akom boli v dopyte.
Časová pečiatka pečiatka udáva čas, kedy respondér naposledy aktualizoval informácie o danom certifikáte a je zakódovaná v POSIX štandarde, vďaka čomu má veľkosť iba štyri bajty. Celý tento atribút má tak pre jeden certifikát veľkosť päť bajtov.

Posledným atribútom je zoznam certifikátov respondéra, ktorý nie je povinný, respondér ho uvádza iba na vyžiadanie od klienta.


\subsubsubsection{Porovnanie s bežným OCSP}
Keďže základný OCSP model obsahuje rôzne nepovinné rozšírenia, ktoré môžu pridať ďalšie bajty, veľkosti dopytov a odpovedí sú závislé na konkrétnych konfiguráciach. Všetky však musia obsahovať povinné polia definované v štandarde pre OCSP, z čoho vyplýva, že dopyty aj odpovede rastú lineárne s počtom certifikátov, ktoré obsahujú.

\begin{figure}[H]
\centering
\includegraphics[height=0.25\textheight]{images/comparison.png}
\caption{Porovnanie veľkostí správ v OCSP a TinyOCSP.}
\end{figure}

Autori pre účely porovnania zobrali konfiguráciu bežného OCSP, ktorá bola optimalizovná tak, aby správy mali čo najmenšiu veľkosť. Túto konfiguráciu následne porovnali s TinyOCSP modelom pre ilustráciu úšetrených dát.

V bežnom OCSP modeli sa v odpovediach opätovne posielajú celé identifikátory všetkých certifikátov, ktoré boli súčasťou dopytu. Táto redundancia vedie k výraznému zväčšeniu správ, pri overovaní väčšieho počtu certifikátov.

Naopak, Tiny OCSP eliminuje túto redundanciu tým, že pre každý dodatočne overovaný certifikát pridá do odpovede iba jeden bajt navyše, a síce stav certifikátu. Vďaka tomuto prístupu je rast veľkosti odpovedí v Tiny OCSP minimálny, čo prináša významné úspory dátovej prevádzky. Ako ilustruje graf vyššie, rozdiel medzi bežným OCSP a Tiny OCSP sa pri väčšom počte certifikátov stáva čoraz výraznejším. 

Tiny OCSP predstavuje efektívnu optimalizáciu klasického OCSP protokolu, ktorá sa zameriava na minimalizáciu veľkosti prenášaných správ a zlepšenie výkonu v prostredí s obmedzenými zdrojmi. Vďaka využitiu kompaktného CBOR kódovania, efektívnemu AKID rozšíreniu a odstráneniu redundantných dát z odpovedí dokáže Tiny OCSP výrazne znížiť dátovú náročnosť komunikácie. Tieto optimalizácie umožňujú, aby veľkosť odpovedí rástla takmer konštantne aj pri zvyšujúcom sa počte certifikátov, čím Tiny OCSP prekonáva tradičný OCSP model. Vďaka týmto vlastnostiam je Tiny OCSP ideálnym riešením pre IoT zariadenia a iné aplikácie, kde je kľúčové šetriť dátovú prevádzku a energetické zdroje.


\subsubsection{Zhrnutie}
Táto kapitola sa zaoberala rôznymi metódami, ktoré zlepšujú efektivitu a bezpečnosť OCSP protokolu. Medzi najvýznamnejšie patrí OCSP Stapling, ktorý rieši hlavné nevýhody tradičného OCSP, ako sú vysoká latencia a záťaž OCSP respondérov, tým, že umožňuje serveru poskytovať OCSP odpovede priamo počas TLS handshake. Rozšírenia ako OCSP Must-Staple a OCSP Multi-Stapling ďalej rozvíjajú tento koncept a poskytujú pridanú hodnotu v oblasti spoľahlivosti a schopnosti overovať celé certifikátové reťazce.

Metódy ako TinyOCSP a CCSP sa odlišujú tým, že upravujú samotný protokol, čím minimalizujú dátovú náročnosť a veľkosť OCSP správ. Tieto prístupy sú obzvlášť užitočné pre IoT zariadenia a prostredia s obmedzenými zdrojmi, pretože výrazne šetria dátovú prevádzku. Na rozdiel od Staplingu a jeho rozšírení, ktoré pracujú so súčasnou infraštruktúrou, tieto riešenia si vyžadujú zásahy do protokolu, čo ich implementáciu robí náročnejšou.



\subsection{Manažérsky pohľad na problematiku}
Z manažérskeho hľadiska má efektívne overovanie platnosti digitálnych certifikátov kľúčový význam pre bezpečnosť, spoľahlivosť a dôveryhodnosť informačných systémov organizácie. V modernom IT ekosystéme, kde digitálne certifikáty hrajú kľúčovú úlohu pri zabezpečení komunikácie, môže neefektívny alebo nespoľahlivý systém overovania platnosti certifikátov predstavovať významné riziko. Táto kapitola analyzuje širšie súvislosti a význam projektu z pohľadu manažmentu a organizácií, ktoré OCSP protokol využívajú.

\subsubsection{Dôsledky zlyhania certifikačných služieb}
Zlyhanie alebo oneskorenie OCSP overovania môže mať závažné dôsledky pre organizácie a ich používateľov. Ak klienti nedokážu overiť platnosť certifikátov, môžu byť vystavení riziku útokov. To môže mať za následok únik citlivých informácií, finančné straty a oslabenie dôvery zákazníkov v služby organizácie. Nedostupnosť OCSP služieb môže viesť k neovereniu platnosti certifikátu, čo má za následok zníženie bezpečnosti spojenia a riziko akceptácie odvolaného certifikátu. V kritických odvetviach, ako je finančný sektor či zdravotníctvo, môžu byť tieto dôsledky ešte závažnejšie, vrátane právnych postihov a sankcií.

\subsubsection{Prevádzkové náklady}
Prevádzka OCSP respondérov je náročná na zdroje, pretože vyžaduje rýchle spracovanie veľkého množstva požiadaviek v reálnom čase. Neefektívne overovanie certifikátov zvyšuje nároky na infraštruktúru, čo vedie k vyšším prevádzkovým nákladom. Zlepšením efektivity OCSP, napríklad prostredníctvom optimalizácie veľkosti správ alebo zavedením cacheovacích mechanizmov, je možné tieto náklady výrazne znížiť a umožniť efektívnejšie využitie zdrojov.

\subsubsection{Regulačné a právne požiadavky}
V mnohých odvetviach existujú prísne regulačné a právne požiadavky týkajúce sa bezpečnosti a ochrany údajov. Napríklad finančné inštitúcie, zdravotníctvo alebo vládne systémy často podliehajú reguláciám, ktoré vyžadujú, aby bolo možné certifikáty okamžite overiť. Nesplnenie týchto požiadaviek môže mať právne dôsledky alebo viesť k pokutám a strate licencie. Zlepšením OCSP je možné splniť tieto požiadavky efektívnejšie a zabezpečiť vyššiu úroveň súladu so zákonmi a reguláciami.

\subsubsection{Zhrnutie}
Investícia do zlepšenia OCSP protokolu prináša strategické výhody. Zníženie nákladov, zlepšenie bezpečnosti, splnenie regulačných požiadaviek a zvýšenie dôveryhodnosti služieb predstavujú významné prínosy, ktoré môžu podporiť dlhodobý úspech organizácie v digitálnom prostredí. To môže viesť k získaniu konkurenčnej výhody na trhu, zvýšeniu trhového podielu a posilneniu značky organizácie.


\subsection{Prenos OCSP komunikácie}
V rámci analýzy je ešte potrebné spomenúť protokol HTTP, ktorý slúži na transtport OCSP komunikácie. HTTP je protokol aplikačnej vrstvy, ktorý sa používa na prenos dát medzi klientom a serverom. V prípade OCSP je jeho úlohou sprostredkovať dopyty od klienta, napríklad webového prehliadača, smerom k OCSP respondéru a spätné odpovede od respondéra ku klientovi. HTTP je dôležitou súčasťou OCSP komunikácie a jeho vlastnosti významne ovplyvňujú výkon a efektivitu celého systému.

\subsubsection{Základné vlastnosti}
HTTP funguje na princípe požiadavka-odpoveď, čo znamená, že klient pošle požiadavku na server a následne čaká na odpoveď. Tento model je pomerne jednoduchý a vychádza z neho aj model pre OCSP. HTTP má pre splnenie rôznych požiadaviek klientov implementované rôzne metódy, z hľadiska OCSP sú relevantné metódy GET a POST.

\subsubsubsection{GET}
Táto metóda sa používa prevažne na načítanie obsahu stránok. Jej hlavička obsahuje identifikátor metódy, URL, prípadné nepovinné parametre a verziu HTTP protokolu. Get metóda spravidla nemá telo.

\begin{figure}[H]
\begin{lstlisting}
GET <URL>["?"<Parametre>] HTTP/Verzia
\end{lstlisting}
\caption{Základná štruktúra GET metódy}
\end{figure}

V rámci OCSP komunikácie sa táto metóda používa pri jednoduchých dopytoch, kde sa všetky potrebné informácie po zahashovaní zmestia do poľa pre URL. Problémom tu však je limit pre počet charakterov v URL, ktorý je 2048 znakov. Preto ak klient potrebuje overiť viac certifikátov naraz, požíva sa nasledovná metóda.

\subsubsubsection{POST}
Táto metóda slúži v kontexte HTTP komunikácie pre poslanie dát od klienta na server, napríkad pri vyplnení formulára na stránke alebo pri vytvorení konta. Jej hlavička vyzerá podobne ako pri GET, s tým rozdielom, že na začiatku je samozrejme odlišný identifikátor metódy. Na rozdiel od GET, metóda POST má spravidla telo.

\begin{figure}[H]
\begin{lstlisting}
POST  <URL>["?"<Parametre>] HTTP/Verzia
<Telo>
\end{lstlisting}
\caption{Základná štruktúra POST metódy}
\end{figure}

OCSP túto metódu využíva vtedy, keď sa požiadavka klienta nezmestí do URL poľa v metóde GET. V takom prípade sa požiadavka ukladá do tela POST metódy a OCSP  respondér na druhom konci ju spracováva rovnako ako tie ktoré mu prišli cez GET.

\subsubsection{HTTP cacheovanie}
Okrem vyššie uvedených častí, HTTP metódy môžu obsahovať aj nepovinné hlavičky, ktoré slúžia na upresnenie informácií pre rôzne účely. Jednou z týchto hlavičiek je \texttt{Cache-Control}, ktorá umožňuje nastavenie pravidiel pre cacheovanie HTTP komunikácie.

Cacheovanie spočíva v ukladaní odpovedí na často opakované požiadavky a je jednou z najväčších výhod HTTP protokolu. Keď klient pošle požiadavku, HTTP cache, napríklad v prehliadači, najskôr overí, či už má odpoveď uloženú a či je táto odpoveď stále platná. Ak je odpoveď dostupná a platná, cache okamžite vráti uložené dáta, čím sa eliminuje potreba komunikácie so vzdialeným serverom.
Tento proces znižuje počet priamych komunikácií medzi klientom a serverom, čím znižuje latenciu, šetrí šírku pásma siete a znižuje záťaž na pôvodný server. V kontexte OCSP komunikácie je cacheovanie kľúčové, pretože tie isté OCSP odpovede sú často požadované viac krát.

\subsubsubsection{Statický a dynamický obsah}
Z hľadiska cacheovania poznáme dva druhy obsahu, statický a dynamický. Statický obsah predstavuje dáta, ktoré sa v čase menia len zriedkavo alebo vôbec. Typicky ide o súbory, akými sú obrázky, CSS a JavaScript súbory, či rôzne dokumenty, na ktoré sa bežne používajú GET požiadavky. Tieto súbory sa pri dodržaní vhodne zvolených hlavičiek na strane servera dajú efektívne cacheovať na dlhšie obdobie. Klient, prípadne sprostredkujúca cache, napríklad CDN, si tak dokáže ukladať a opakovane používať nezmenené verzie týchto súborov bez nutnosti opätovného kontaktu so serverom.

Dynamický obsah, naopak, predstavuje dáta, ktoré sa môžu pri každej požiadavke meniť. Typickým príkladom sú odpovede z API služieb, výsledky vyhľadávania či personalizovaný obsah generovaný na strane servera, na ktoré sa zvyčajne používajú POST požiadavky. Keďže sa tieto dáta môžu meniť aj pri dvoch po sebe nasledujúcich požiadavkách, cacheovanie dynamického obsahu býva limitované a riadené dodatočnými mechanizmami, alebo úplne vypnuté.

V kontexte OCSP komunikácie slúžia aj GET aj POST metódy taký istý obsah. Aj keď nie je úplne statický, vzhľadom na dobu platnosti odpovede pre certifikát, stále sa dá správnym prístupom efektívne cacheovať. Tento nedostatok vychádza z toho, že POST požiadavky sú všeobecne zaužívané na iný druh použitia než na čo ich využíva OCSP. Práve tento nedostatok skúsime vylepšiť v tejto práci.

V kontexte OCSP komunikácie slúžia metódy GET aj POST na získavanie toho istého typu obsahu. Hoci tento obsah vzhľadom na obmedzenú dobu platnosti odpovede pre certifikát nie je úplne statický, stále je možné ho pri správnom prístupe efektívne cacheovať. Problém spočíva v tom, že POST požiadavky sú všeobecne zaužívané pre dynamické operácie, kde sa odpovede spravidla necacheujú, čo nezohľadňuje špecifiká OCSP protokolu. V tejto práci sa zameriame na zlepšenie tohto nedostatku návrhom efektívneho mechanizmu cacheovania POST požiadaviek.


\subsection{Zhodnotenie analýzy}
Analýza problematiky objasnila teoretické oblasti potrebné pre pochopenie tejto práce, uviedla súčasný stav v oblasti OCSP protokolu so zameraním na jeho slabé stránky a následne určila náš ciel pre riešenie problému zlepšenia efektivity OCSP protokolu.



\section{Špecifikácia požiadaviek}
V tejto kapitole uvedieme funkčné a nefunkčné požiadavky pre naše riešenie.

\subsection{Nie-funkčné požiadavky}
Riešenie bude implementované ako počítačová aplikácia, naprogramovaná v jazyku C++, ktorý je dobrou voľbou na takýto projekt, lebo poskytuje vysoký výkon, efektívne spracovanie pamäte a umožňuje priamu prácu s nízkoúrovňovými sieťovými protokolmi, ako je HTTP.
Používateľské rozhranie bude textové v príkazovom riadku.

\subsection{Funkčné požiadavky}

\begin{itemize}
\item \textbf{Prijímanie a spracovanie  GET a POST požiadaviek} \\
Aplikácia  musí byť schopná prijať a spracovať požiadavky na OCSP respondéra, ktoré musíia byť validované na správnosť formátu a obsahu podľa štandardov OCSP. 

\item \textbf{Komunikácia s OCSP respondérom} \\
Ak požiadavka nemá zodpovedajúcu cacheovanú odpoveď, systém musí kontaktovať OCSP respondér, získať aktuálnu odpoveď a uložiť ju do cache.

\item \textbf{Cacheovanie odpovedí} \\
Aplikácia musí byť schopná uložiť odpovede na GET aj POST požiadavky do cache tak, aby boli opätovne použiteľné pre rovnakú požiadavku, pokiaľ tá neprekročila dobu platnosti definovanú v OCSP odpovediach.

\item \textbf{Vypršanie platnosti cacheovaných odpovedí} \\
Cacheované odpovede musia byť automaticky odstránené po prekročení ich definovanej doby platnosti.

\item \textbf{Škálovateľnosť cache} \\
Cache musí byť schopná spravovať odpovede pre minimálne 10 000 jedinečných požiadaviek.

\item \textbf{Logovanie stavov aplikácie} \\
Systém musí zaznamenávať všetky podstatné procedúry spolu s časovými pečiatkami ich uskutočnenia do logovacieho súboru.

\item \textbf{Konfigurácia systému} \\
Aplikácia musí umožňovať konfiguráciu maximálnej veľkosti cache, doby platnosti odpovedí a ďalších podstatných súčastí prostredníctvom konfiguračného súboru.

\item \textbf{Práca s chybovými stavmi} \\
Ak v hociktorom bode procesu aplikácia nie je schopná plniť svoj účel, musí používateľovi poskytnúť deskriptívne informácie o tom, prečo nie je možné pokračovať a nesmie spadnúť s chybou.
\end{itemize}

\section{Návrh riešenia}
Táto kapitola obsahuje návrh aplikácie, vrátane podrobného návrhu pre aplikáciu a príkladu konfiguračného súboru.

\subsection{Návrh HTTP servera}
HTTP server bude prijímať GET a POST požiadavky od klientov. Tieto požiadavky budú obsahovať OCSP dopyty na overenie stavu certifikátov. Server bude spracovávať prichádzajúce dopyty, vyhľadávať odpovede v cache a v prípade potreby kontaktovať OCSP respondér. Následne server vráti odpoveď klientovi.

\subsubsection{Spracovanie a validácia OCSP dopytov}
\begin{enumerate}
\item \textbf{Prijatie HTTP požiadavky} \\
HTTP server príjme GET alebo POST požiadavku obsahujúcu OCSP dopyt.  

\item \textbf{Extrahovanie OCSP dopytu} \\
Zo samotnej HTTP požiadavky sa extrahuje OCSP dopyt, ktorý obsahuje identifikátory certifikátov určených na overenie. 

\item \textbf{Validácia formátu dopytu} \\ 
Dopyt sa skontroluje, či má správny formát podľa ASN.1 DER kódovania a zodpovedá OCSP špecifikácii. Ak niečo nesedí, server odošle klientovi informáciu o chybnom dopyte a proces tu končí.

\item \textbf{Kontrola v cache} \\ 
Extrahované certifikáty sa vyhľadajú v cache:  
	
	\begin{itemize}
	\item Ak je odpoveď v cache a je stále platná, vráti sa klientovi.  
	\item Ak odpoveď nie je dostupná alebo je exspirovaná, pokračuje sa ďalšími krokmi.  
	\end{itemize}  

\item \textbf{Tvorba OCSP dopytu na respondér} \\ 
V prípade, že dopyt nie je v cache, server vytvorí novú OCSP požiadavku adresovanú OCSP respondérovi a odošle ju na spracovanie.  

\item \textbf{Prijatie a validácia OCSP odpovede} \\ 
Server príjme odpoveď od OCSP respondéra a overí, či je podpis odpovede platný a či odpoveď má správny formát.  

\item \textbf{Uloženie odpovede do cache} \\ 
Platná odpoveď sa uloží do cache s príslušným časom exspirácie.  

\item \textbf{Odoslanie odpovede klientovi} \\ 
OCSP odpoveď je vrátená klientovi v rámci HTTP odpovede.  
\end{enumerate}


\subsection{Návrh cache}
Cache mechanizmus je navrhnutý ako súčasť HTTP servera, ktorá bude spracovávať OCSP požiadavky. Hlavným cieľom cache je znížiť záťaž OCSP respondérov tým, že okrem uchovávania odpovedí na GET požiadavky bude uchovávať aj odpovede na POST požiadavky. Týmto spôsobom sa eliminuje potreba opakovaného dopytovania respondéra pri každej požiadavke na overenie sady viacerých certifikátov, čím sa zlepší výkon systému poskytovania informácií o revokácií certifikátov.

\subsubsection{Architektúra cache}
Cache bude implementovaná ako pamäťová štruktúra priamo na strane HTTP servera a bude mať dve úrovne. Prvá úroveň bude slúžiť na uchovávanie odpovedí pre jednotlivé certifikáty z GET požiadaviek a druhá úroveň bude slúžiť na uchovávanie odpovedí pre sady certifikátov z POST požiadaviek. Obe úrovne budú reprezentované hashmapou.

V prvej úrovni bude kľúčom identifikátor certifikátu, v druhej to bude hash zo zreťazených a zoradených identifikátorov certifikátov v danej sade. Hodnotou v oboch úrovniach budú objekty, ktoré budú obsahovať odpoveď pre dané certifikáty, čas jej exspirácie a metadáta pre účely správy - čas posledného prístupu a počet prístupov.

\subsubsection{Proces vyhľadávania v cache pre jednotlivé certifikáty}
\begin{enumerate}
\item Z prichádzajúcej požiadavky sa extrahuje identifikátor certifikátu.
\item Vykoná sa vyhľadanie identifikátoru v cache pre jednotlivé certifikáty:
    \begin{itemize}
    \item Ak existuje záznam a jeho exspiračný čas neuplynul, vráti sa OCSP odpoveď.
    \item Ak sa odpoveď nenájde alebo exspirovala, požiadavka sa odošle na OCSP respondér. Odpoveď sa po obdržaní vráti klientovi a uloží do cache.
    \end{itemize}
\end{enumerate}

\subsubsection{Proces vyhľadávania v cache pre sady certifikátov}
\begin{enumerate}
\item Extrahujú sa identifikátory certifikátov z prichádzajúcej OCSP požiadavky napr.: \{C3, C1, C2\}.
\item Identifikátory sa číselne zoradia: \{C1, C2, C3\}.
\item Zoradené identifikátory sa zreťazia a vypočíta sa ich hash.
\item Tento hash sa vyhľadá v cache pre sady certifikátov:
    \begin{itemize}
    \item Ak existuje záznam s týmto hashom a jeho exspiračný čas neuplynul, vráti sa OCSP odpoveď.
    \item Ak sa odpoveď nenájde alebo exspirovala, požiadavka sa odošle na OCSP respondér. Odpoveď sa po obdržaní vráti klientovi a uloží do cache.
    \end{itemize}
\end{enumerate}

Tento proces zabezpečuje rýchlu odozvu pre opakované požiadavky a znižuje záťaž na OCSP respondér pomocou ukladania odpovedí.

\subsubsection{Manažment uchovávaných odpovedí}
Manažment cache bude zahŕňať pravidelnú kontrolu platnosti uložených odpovedí. Systém bude periodicky prechádzať cache a odstraňovať záznamy, ktorých doba platnosti uplynula. Okrem toho, ak počet uložených odpovedí dosiahne maximálnu kapacitu cache, automaticky sa odstránia najstaršie a najmenej často používané odpovede. Tento prístup zabezpečí, že cache zostane efektívna a nedôjde k jej preťaženiu.  

\subsection{Mechanizmus pre logovanie udalostí}
Mechanizmus pre logovanie udalostí bude navrhnutý tak, aby poskytoval prehľad o fungovaní aplikácie a slúžil na diagnostiku chýb. Logovanie bude obsahovať nasledovné prvky:

\begin{itemize}
    \item \textbf{Typy udalostí:}  
    Logovať sa budú dôležité udalosti vrátane:
    \begin{itemize}
        \item Prijatia HTTP požiadavky (GET/POST)
        \item Hitov a missov v cache
        \item Poslania požiadavky na OCSP respondér a prijatia odpovede
        \item Chýb pri validácii OCSP dopytov alebo odpovedí
        \item Údržby cache
    \end{itemize}

    \item \textbf{Formát logov:}  
    Každý záznam v logu bude obsahovať:
    \begin{itemize}
        \item Dátum a čas udalosti,
        \item Typ udalosti,
        \item Popis udalosti (napr. ID certifikátu alebo sady certifikátov),
        \item Úroveň závažnosti.
    \end{itemize}
\end{itemize}

Logy budú zapisované do súboru, ktorého miesto uloženia bude konfigurovateľné. Takto navrhnutý systém logovania zabezpečí transparentnosť fungovania aplikácie a umožní efektívne riešenie problémov a optimalizáciu výkonu.



\subsection{Príklad konfigurácie}
Nižšie je uvedený príklad konfiguračného súboru, ktorý definuje pravidlá pre cacheovanie OCSP odpovedí a cestu pre ukladanie logovacích súborov.
\begin{verbatim}
{
  "cache1": {
    "enabled": true,
    "ttl": 3600,
    "max_entries": 5000
  },
  "cache2": {
    "enabled": true,
    "ttl": 3600,
    "max_entries": 5000
  },
  log: {
    "path": ./logs/
  }
}
\end{verbatim}

\textbf{Popis konfiguračných parametrov:}
\begin{itemize}
\item \textbf{cache1, cache2}: Prvá a druhá úroveň cache.

\item \textbf{enabled}: Povolenie alebo zakázanie cache mechanizmu.

\item \textbf{ttl}: Doba, po ktorú je OCSP odpoveď platná v sekundách. Po uplynutí tejto doby bude odpoveď automaticky odstránená.

\item \textbf{max\_entries}: Maximálny počet odpovedí uložených v cache. Po prekročení tejto hodnoty budú najstaršie záznamy odstránené.

\item \textbf{log}: Parametre pre logovanie, obsahujú cestu pre ukladanie logov.
\end{itemize}

Konfiguračný súbor poskytuje flexibilitu pri nastavovaní správania cache a logovania, čím umožňuje prispôsobenie aplikácie rôznym požiadavkám na výkon a údržbu. 


\section{Implementácia}


\subsection{Zmeny oproti návrhu}


\subsection{Opis tried}


\section{Overenie riešenia}


\subsection{Splnenie špecifikovaných požiadaviek}



\subsection{Testovanie}


\subsection{Zhodnotenie overovania riešenia}



\section{Zhodnotenie}



\newpage\null\thispagestyle{empty}\newpage

\makeatletter
\addtocontents{toc}{\def\string\@dotsep{100}}
\makeatother

%\thispagestyle{plain}
\phantomsection
\addcontentsline{toc}{section}{Literatúra}

%\pagenumbering{gobble}

\bibliographystyle{unsrtnat} 

\bibliography{mybib}
%\setcounter{page}{46}

\newpage\null\thispagestyle{empty}\newpage
\newpage
\pagestyle{fancy}
\setcounter{page}{1}
\renewcommand{\thepage}{A-\arabic{page}}
\fancyhf{}
\fancyfoot[C]{\thepage} 
\thispagestyle{plain}
\makeatletter
\addtocontents{toc}{\def\string\@dotsep{4.5}}  % 4.5 might be a different value in your class
\makeatother
\phantomsection
\addcontentsline{toc}{section}{Príloha A: Plán práce}

\section*{Príloha A: Plán práce} 
V tejto prílohe sú v tabuľkách uvedené plány práce rozdelené na zimný a letný semester a je pri nich uvedené ako sa ich darilo plniť.

\subsection*{Zimný semester}

\begin{table}[H]
\begin{center}
\renewcommand\thetable{A.1}
\caption{Plán na zimný semester pre bakalársku prácu}
\begin{tabular}{ |c|C{10cm}| } 
 \hline
\textbf{Týždeň} & \textbf{Plán} 
 \\ \hline
1-4  & Analýza problematiky OCSP protokolu 
\\ \hline
5-7  & Analýza existujúcich vylepšení OCSP protokolu
\\ \hline
8-10  &  Návrh vlastného vylepšenia.
\\ \hline
11-12  & Dokončenie dokumentu.
\\ \hline
\end{tabular}
\end{center}
\end{table}

Tu bude uvedené ako sa darilo plniť plán na zimný semester

\subsection*{Letný semester}

\begin{table}[H]
\begin{center}
\renewcommand\thetable{A.2}
\caption{Plán na letný semester pre bakalársku prácu}
\begin{tabular}{ |c|C{10cm}| } 
 \hline
\textbf{Týždeň} & \textbf{Plán} 
 \\ \hline
x-x  & xxxxx
\\ \hline
x-x  & xxxxx
\\ \hline
x-x  & xxxxx
\\ \hline
x-x  & xxxxx
\\ \hline
\end{tabular}
\end{center}
\end{table}

Tu bude uvedené ako sa darilo plniť plán na letný semester

\newpage
\pagestyle{fancy}
\setcounter{page}{1}
\renewcommand{\thepage}{B-\arabic{page}} 
\thispagestyle{plain}
\makeatletter
\addtocontents{toc}{\def\string\@dotsep{4.5}}  % 4.5 might be a different value in your class
\makeatother
\phantomsection
\addcontentsline{toc}{section}{Príloha B: Technická dokumentácia}

\section*{Príloha B: Technická dokumentácia}



\section*{Príloha C: Používateľská príručka}



\subsection{Pred spustením}



\section*{Príloha D: Obsah elektronického média}

\bigskip
\bigskip

Adresáre:
\begin{itemize}
\item
...
\end{itemize}

Súbory:
\begin{itemize}
\item 
...
\end{itemize}
 
\end{document}





